# Folder Sharing Feature

This document describes the folder sharing functionality implemented in the drive application.

## Overview

The folder sharing feature allows users to create temporary, shareable links to specific folders within their workspaces. These links can have expiration dates and provide view-only access to the shared folder contents.

## Features

### 1. Share Link Creation
- **Location**: "Give view access" button appears in the folder header when viewing a folder
- **Access**: Only available to users with edit permissions on the workspace
- **Requirements**: 
  - Must be viewing a specific folder (not root)
  - Must provide a description of who the link is being shared with
  - Can set expiration date (1-365 days, or never)

### 2. Share Link Format
```
https://drive.aiworkspace.pro/single-workspace/{workspace_id}/files?folder={encoded_folder_path}&share={share_token}
```

### 3. Share Validation
- **Automatic**: Share tokens are validated when accessing shared URLs
- **Expiry Check**: Expired shares are automatically rejected
- **Access Tracking**: Each access increments a counter and updates last accessed time
- **Security**: Invalid or expired shares show error messages and redirect

### 4. Shared Access Experience
- **Visual Indicator**: "Shared Access" tag appears in the header
- **Limited Actions**: Upload, create folder, and other edit actions are hidden
- **View Only**: Users can only view and download files, not modify them

## Database Schema

### `folder_shares` Table
```sql
CREATE TABLE folder_shares (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    workspace_id bigint REFERENCES workspaces(id) NOT NULL,
    folder_path text NOT NULL,
    share_token character varying(64) UNIQUE NOT NULL,
    shared_by uuid REFERENCES auth.users(id) NOT NULL,
    shared_with_description text,
    expires_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    access_count integer DEFAULT 0 NOT NULL,
    last_accessed_at timestamp with time zone
);
```

### Key Functions
- `generate_share_token()`: Creates unique 32-character hex tokens
- `increment_share_access(share_token_param)`: Tracks access and updates counters

## Usage Example

1. **Srishti** navigates to a folder: `https://drive.aiworkspace.pro/single-workspace/5/files?folder=filings%252FRFO%252FP%27s%252F2025-06-20%2520Motion%2520to%2520consolidate%2520actions`

2. **Srishti** clicks "Give view access" button

3. **Srishti** fills out the form:
   - **Who is this link being shared with?**: "Going to share with Roger and Stephanie"
   - **Expires in**: 10 days

4. **System** generates a shareable link like:
   ```
   https://drive.aiworkspace.pro/single-workspace/5/files?folder=filings%252FRFO%252FP%27s%252F2025-06-20%2520Motion%2520to%2520consolidate%2520actions&share=a1b2c3d4e5f6...
   ```

5. **Roger and Stephanie** can access the folder using the shared link for 10 days

## Security Features

- **Token-based**: Uses cryptographically secure random tokens
- **Expiration**: Automatic expiry based on user-defined timeframes
- **Access Control**: Only users with edit permissions can create shares
- **View-only**: Shared access is strictly read-only
- **Audit Trail**: Tracks who created shares, when, and access patterns

## Implementation Details

### Frontend (Vue.js)
- Share button in `FilesCt.vue` component
- Modal dialog for share creation
- Route validation for share tokens
- UI state management for shared access mode

### Backend (Supabase)
- Row Level Security (RLS) policies
- Database functions for token generation and access tracking
- Automatic cleanup of expired shares (can be implemented as scheduled job)

## Future Enhancements

- **Password Protection**: Add optional password protection for shares
- **Access Logs**: Detailed access logs with user identification
- **Bulk Sharing**: Share multiple folders at once
- **Share Management**: UI to view and manage existing shares
- **Notifications**: Email notifications when shares are accessed
- **Custom Expiry**: More granular expiry options (hours, specific dates)
